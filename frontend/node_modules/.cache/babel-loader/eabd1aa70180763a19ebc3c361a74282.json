{"ast":null,"code":"import _toConsumableArray from \"/home/ivan/react-mesto-api-full/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";\nimport _slicedToArray from \"/home/ivan/react-mesto-api-full/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\nvar _jsxFileName = \"/home/ivan/react-mesto-api-full/frontend/src/components/App.js\";\nimport React, { useEffect, useState } from 'react';\nimport Header from './Header';\nimport Main from './Main';\nimport Footer from './Footer';\nimport ImagePopup from './ImagePopup';\nimport EditProfilePopup from \"./EditProfilePopup\";\nimport EditAvatarPopup from \"./EditAvatarPopup\";\nimport AddPopup from \"./AddPopup\";\nimport DeletePopup from \"./DeletePopup\";\nimport { Route, Routes, useNavigate, useLocation, Navigate } from 'react-router-dom';\nimport { api } from '../utils/Api';\nimport { CurrentUserContext } from \"../contexts/CurrentUserContext.js\";\nimport Register from '../components/Register';\nimport Login from '../components/Login';\nimport RequireAuth from './ProtectedRoute';\nimport * as auth from '../utils/auth';\nimport InfoTooltip from '../components/InfoTooltip';\n\nfunction App() {\n  var _useState = useState(false),\n      _useState2 = _slicedToArray(_useState, 2),\n      loggedIn = _useState2[0],\n      setLoggedIn = _useState2[1];\n\n  var _useState3 = useState(''),\n      _useState4 = _slicedToArray(_useState3, 2),\n      userEmail = _useState4[0],\n      setUserEmail = _useState4[1];\n\n  var navigate = useNavigate();\n  var location = useLocation();\n\n  var _React$useState = React.useState(false),\n      _React$useState2 = _slicedToArray(_React$useState, 2),\n      isEditProfilePopupOpen = _React$useState2[0],\n      setIsEditProfilePopupOpen = _React$useState2[1];\n\n  function handleEditProfileClick() {\n    setIsEditProfilePopupOpen(true);\n  }\n\n  var _React$useState3 = React.useState(false),\n      _React$useState4 = _slicedToArray(_React$useState3, 2),\n      isAddCardPopupOpen = _React$useState4[0],\n      setisAddCardPopupOpen = _React$useState4[1];\n\n  function handleAddCardClick() {\n    setisAddCardPopupOpen(true);\n  }\n\n  var _React$useState5 = React.useState(false),\n      _React$useState6 = _slicedToArray(_React$useState5, 2),\n      isAvatarProfilePopupOpen = _React$useState6[0],\n      setisAvatarProfilePopupOpen = _React$useState6[1];\n\n  function handleAvatarProfileClick() {\n    setisAvatarProfilePopupOpen(true);\n  }\n\n  var _React$useState7 = React.useState(null),\n      _React$useState8 = _slicedToArray(_React$useState7, 2),\n      selectedCard = _React$useState8[0],\n      setSelectedCard = _React$useState8[1];\n\n  function handleCardClick(card) {\n    setSelectedCard(card);\n    setIsImagePopupOpenen(true);\n  }\n\n  var _React$useState9 = React.useState(false),\n      _React$useState10 = _slicedToArray(_React$useState9, 2),\n      isImagePopupOpenen = _React$useState10[0],\n      setIsImagePopupOpenen = _React$useState10[1]; ////////////////////////\n\n\n  var _React$useState11 = React.useState(false),\n      _React$useState12 = _slicedToArray(_React$useState11, 2),\n      isSucceed = _React$useState12[0],\n      setIsSucceed = _React$useState12[1];\n\n  var _React$useState13 = React.useState(false),\n      _React$useState14 = _slicedToArray(_React$useState13, 2),\n      isInfoTooltipOpen = _React$useState14[0],\n      setIsInfoTooltipOpen = _React$useState14[1];\n\n  function handleInfoTooltipPopupOpen() {\n    setIsInfoTooltipOpen(!isInfoTooltipOpen);\n  }\n\n  function closeAllPopups() {\n    setIsEditProfilePopupOpen(false);\n    setisAddCardPopupOpen(false);\n    setisAvatarProfilePopupOpen(false);\n    setSelectedCard(null);\n    setIsDeletePopupOpenen(false);\n    setIsImagePopupOpenen(false);\n    setIsInfoTooltipOpen(false);\n  } ////////////////////////////////////////////\n\n\n  useEffect(function () {\n    handleTokenCheck(location.pathname);\n\n    if (loggedIn) {\n      Promise.all([api.getUserInfo(), api.getInitialCards()]).then(function (_ref) {\n        var _ref2 = _slicedToArray(_ref, 2),\n            user = _ref2[0],\n            items = _ref2[1];\n\n        setCurrentUser(user.data);\n        setCards(items);\n        navigate('/');\n      }).catch(function (err) {\n        console.log(err);\n        return [];\n      });\n    }\n  }, [loggedIn]);\n  useEffect(function () {\n    handleTokenCheck(location.pathname);\n    console.log('lp' + location.pathname);\n  }, []);\n\n  var _React$useState15 = React.useState({}),\n      _React$useState16 = _slicedToArray(_React$useState15, 2),\n      currentUser = _React$useState16[0],\n      setCurrentUser = _React$useState16[1];\n\n  var _React$useState17 = React.useState([]),\n      _React$useState18 = _slicedToArray(_React$useState17, 2),\n      cards = _React$useState18[0],\n      setCards = _React$useState18[1];\n\n  function handleCardLike(card) {\n    var isLiked = card.likes.some(function (i) {\n      return i === currentUser._id;\n    });\n\n    if (isLiked) {\n      api.deleteLike(card._id).then(function (newCard) {\n        setCards(function (state) {\n          return state.map(function (c) {\n            return c._id === card._id ? newCard.data : c;\n          });\n        });\n      }).catch(function (err) {\n        console.log(err);\n        return [];\n      });\n    } else {\n      api.addLike(card._id).then(function (newCard) {\n        setCards(function (state) {\n          return state.map(function (c) {\n            return c._id === card._id ? newCard : c;\n          });\n        });\n        console.log(card);\n      }).catch(function (err) {\n        console.log(err);\n        return [];\n      });\n    }\n  } ////////////////\n\n\n  function handleEditUser(data) {\n    api.editProfile(data).then(function (data) {\n      setCurrentUser(data.data);\n      console.log(data);\n      closeAllPopups();\n    }).catch(function (err) {\n      return console.log(err);\n    });\n  }\n\n  function handleUpdateAvatar(data) {\n    api.addAvatar(data).then(function (data) {\n      console.log(data);\n      setCurrentUser(data.data);\n      closeAllPopups();\n    }).catch(function (err) {\n      return console.log(err);\n    });\n  }\n\n  function handleAddPlace(data) {\n    api.addPlace(data).then(function (newCard) {\n      // console.log(data);\n      // console.log(newCard);\n      // console.log(newCard.data);\n      setCards([newCard.data].concat(_toConsumableArray(cards)));\n      closeAllPopups();\n    }).catch(function (err) {\n      return console.log(err);\n    });\n  }\n\n  var _React$useState19 = React.useState(false),\n      _React$useState20 = _slicedToArray(_React$useState19, 2),\n      isDeletePopupOpenen = _React$useState20[0],\n      setIsDeletePopupOpenen = _React$useState20[1];\n\n  function handleCardDeleteClick(card) {\n    setIsDeletePopupOpenen(true);\n    setSelectedCard(card);\n  }\n\n  function handleDeletePlace(card) {\n    api.deletePost(card._id).then(function () {\n      setCards(function (state) {\n        return state.filter(function (c) {\n          return c._id !== card._id;\n        });\n      });\n      closeAllPopups();\n    }).catch(function (err) {\n      return console.log(err);\n    });\n  }\n\n  var handleLogin = function handleLogin(email, password) {\n    auth.authorize(email, password).then(function (res) {\n      if (res.token) {\n        localStorage.setItem('jwt', res.token);\n        setUserEmail(email);\n      }\n\n      setLoggedIn(true);\n    }).catch(function (err) {\n      console.log(err);\n      setIsSucceed(false);\n      handleInfoTooltipPopupOpen();\n    });\n  };\n\n  var handleTokenCheck = function handleTokenCheck() {\n    var jwt = localStorage.getItem(\"jwt\"); // проверяем токен пользователя\n\n    if (jwt) {\n      auth.checkToken(jwt).then(function (res) {\n        if (res) {\n          setUserEmail(res.data.email);\n          setLoggedIn(true);\n        }\n      }).catch(function (err) {\n        return console.log(err);\n      });\n    }\n  };\n\n  var handleLogout = function handleLogout(evt) {\n    evt.preventDefault();\n    localStorage.removeItem('jwt');\n    setLoggedIn(false);\n    setUserEmail('');\n    navigate('/sign-in');\n  };\n\n  var handleRegister = function handleRegister(password, email) {\n    auth.register(email, password).then(function (res) {\n      if (res) {\n        setIsSucceed(true);\n        handleInfoTooltipPopupOpen();\n        navigate(\"/sign-in\");\n      }\n    }).catch(function (err) {\n      console.log(\"\\u041E\\u0448\\u0438\\u0431\\u043A\\u0430 \\u0440\\u0435\\u0433\\u0438\\u0441\\u0442\\u0440\\u0430\\u0446\\u0438\\u0438 \".concat(err));\n      setIsSucceed(false);\n      handleInfoTooltipPopupOpen();\n    });\n  };\n\n  return /*#__PURE__*/React.createElement(CurrentUserContext.Provider, {\n    value: currentUser,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 213,\n      columnNumber: 5\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"page\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 214,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(Routes, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 215,\n      columnNumber: 11\n    }\n  }, /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(Route, {\n    path: \"/\",\n    element: /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(RequireAuth, {\n      loggedIn: loggedIn,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 221,\n        columnNumber: 21\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 222,\n        columnNumber: 23\n      }\n    }, /*#__PURE__*/React.createElement(Header, {\n      nav: '/sign-in',\n      navStatus: 'Выйти',\n      emailUser: userEmail,\n      onLogout: handleLogout,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 223,\n        columnNumber: 25\n      }\n    }), /*#__PURE__*/React.createElement(Main, {\n      onEditProfile: handleEditProfileClick,\n      onAddPlace: handleAddCardClick,\n      onEditAvatar: handleAvatarProfileClick,\n      onCardClick: handleCardClick,\n      onCardLike: handleCardLike,\n      onCardDeleteClick: handleCardDeleteClick,\n      cards: cards,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 229,\n        columnNumber: 25\n      }\n    }), /*#__PURE__*/React.createElement(Footer, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 238,\n        columnNumber: 25\n      }\n    })))),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 217,\n      columnNumber: 15\n    }\n  }), /*#__PURE__*/React.createElement(Route, {\n    path: \"/sign-up\",\n    element: /*#__PURE__*/React.createElement(Register, {\n      onRegister: handleRegister,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 244,\n        columnNumber: 47\n      }\n    }),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 244,\n      columnNumber: 15\n    }\n  }), /*#__PURE__*/React.createElement(Route, {\n    path: \"/sign-in\",\n    element: /*#__PURE__*/React.createElement(Login, {\n      onLogin: handleLogin,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 245,\n        columnNumber: 47\n      }\n    }),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 245,\n      columnNumber: 15\n    }\n  }), /*#__PURE__*/React.createElement(Route, {\n    path: \"*\",\n    element: loggedIn ? /*#__PURE__*/React.createElement(Navigate, {\n      to: \"/\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 248,\n        columnNumber: 39\n      }\n    }) : /*#__PURE__*/React.createElement(Navigate, {\n      to: \"/sign-in\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 248,\n        columnNumber: 61\n      }\n    }),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 246,\n      columnNumber: 15\n    }\n  }))), /*#__PURE__*/React.createElement(InfoTooltip, {\n    isOpen: isInfoTooltipOpen,\n    onClose: closeAllPopups,\n    isSucceed: isSucceed,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 252,\n      columnNumber: 11\n    }\n  }), /*#__PURE__*/React.createElement(EditProfilePopup, {\n    isOpen: isEditProfilePopupOpen,\n    onClose: closeAllPopups,\n    onEditUser: handleEditUser,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 257,\n      columnNumber: 11\n    }\n  }), /*#__PURE__*/React.createElement(AddPopup, {\n    isOpen: isAddCardPopupOpen,\n    onClose: closeAllPopups,\n    onAddPost: handleAddPlace,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 262,\n      columnNumber: 11\n    }\n  }), /*#__PURE__*/React.createElement(EditAvatarPopup, {\n    isOpen: isAvatarProfilePopupOpen,\n    onClose: closeAllPopups,\n    onUpdateAvatar: handleUpdateAvatar,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 267,\n      columnNumber: 11\n    }\n  }), /*#__PURE__*/React.createElement(ImagePopup, {\n    isOpen: isImagePopupOpenen,\n    card: selectedCard,\n    onClose: closeAllPopups,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 272,\n      columnNumber: 11\n    }\n  }), /*#__PURE__*/React.createElement(DeletePopup, {\n    isOpen: isDeletePopupOpenen,\n    onClose: closeAllPopups,\n    card: selectedCard,\n    onDeletePlace: handleDeletePlace,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 277,\n      columnNumber: 11\n    }\n  })));\n}\n\nexport default App;","map":{"version":3,"sources":["/home/ivan/react-mesto-api-full/frontend/src/components/App.js"],"names":["React","useEffect","useState","Header","Main","Footer","ImagePopup","EditProfilePopup","EditAvatarPopup","AddPopup","DeletePopup","Route","Routes","useNavigate","useLocation","Navigate","api","CurrentUserContext","Register","Login","RequireAuth","auth","InfoTooltip","App","loggedIn","setLoggedIn","userEmail","setUserEmail","navigate","location","isEditProfilePopupOpen","setIsEditProfilePopupOpen","handleEditProfileClick","isAddCardPopupOpen","setisAddCardPopupOpen","handleAddCardClick","isAvatarProfilePopupOpen","setisAvatarProfilePopupOpen","handleAvatarProfileClick","selectedCard","setSelectedCard","handleCardClick","card","setIsImagePopupOpenen","isImagePopupOpenen","isSucceed","setIsSucceed","isInfoTooltipOpen","setIsInfoTooltipOpen","handleInfoTooltipPopupOpen","closeAllPopups","setIsDeletePopupOpenen","handleTokenCheck","pathname","Promise","all","getUserInfo","getInitialCards","then","user","items","setCurrentUser","data","setCards","catch","err","console","log","currentUser","cards","handleCardLike","isLiked","likes","some","i","_id","deleteLike","newCard","state","map","c","addLike","handleEditUser","editProfile","handleUpdateAvatar","addAvatar","handleAddPlace","addPlace","isDeletePopupOpenen","handleCardDeleteClick","handleDeletePlace","deletePost","filter","handleLogin","email","password","authorize","res","token","localStorage","setItem","jwt","getItem","checkToken","handleLogout","evt","preventDefault","removeItem","handleRegister","register"],"mappings":"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","sourcesContent":["import React, { useEffect, useState } from 'react';\nimport Header from './Header';\nimport Main from './Main';\nimport Footer from './Footer';\nimport ImagePopup from './ImagePopup';\nimport EditProfilePopup from \"./EditProfilePopup\";\nimport EditAvatarPopup from \"./EditAvatarPopup\";\nimport AddPopup from \"./AddPopup\";\nimport DeletePopup from \"./DeletePopup\";\nimport { Route, Routes, useNavigate, useLocation,Navigate } from 'react-router-dom';\nimport {api}  from '../utils/Api';\nimport { CurrentUserContext } from \"../contexts/CurrentUserContext.js\";\nimport Register from '../components/Register';\nimport Login from '../components/Login';\nimport RequireAuth from './ProtectedRoute';\nimport * as auth from '../utils/auth';\nimport InfoTooltip from '../components/InfoTooltip';\n\nfunction App() {\n  \n  const [loggedIn, setLoggedIn] = useState(false);\n  const [userEmail, setUserEmail] = useState('');\n  const navigate = useNavigate();\n  const location = useLocation();\n  const [isEditProfilePopupOpen, setIsEditProfilePopupOpen] = React.useState(false);\n  function handleEditProfileClick() {\n    setIsEditProfilePopupOpen(true);\n  }\n  const [isAddCardPopupOpen, setisAddCardPopupOpen] = React.useState(false);\n  function handleAddCardClick() {\n    setisAddCardPopupOpen(true);\n  }\n  const [isAvatarProfilePopupOpen, setisAvatarProfilePopupOpen] = React.useState(false);\n  function handleAvatarProfileClick() {\n    setisAvatarProfilePopupOpen(true);\n  }\n  const [selectedCard, setSelectedCard] = React.useState(null);\n  function handleCardClick(card) {\n    setSelectedCard(card);\n    setIsImagePopupOpenen(true);\n  }\n  const [isImagePopupOpenen, setIsImagePopupOpenen] = React.useState(false);\n  ////////////////////////\n  const [isSucceed, setIsSucceed] = React.useState(false);\n  const [isInfoTooltipOpen, setIsInfoTooltipOpen] = React.useState(false);\n  function handleInfoTooltipPopupOpen() {\n    setIsInfoTooltipOpen(!isInfoTooltipOpen);\n  }\n  \n  function closeAllPopups() {\n    setIsEditProfilePopupOpen(false);\n    setisAddCardPopupOpen(false);\n    setisAvatarProfilePopupOpen(false);\n    setSelectedCard(null);\n    setIsDeletePopupOpenen(false);\n    setIsImagePopupOpenen(false);\n    setIsInfoTooltipOpen(false);\n  }\n  ////////////////////////////////////////////\n  useEffect(() => {\n    handleTokenCheck(location.pathname);\n    if (loggedIn) {\n      Promise.all([api.getUserInfo(), api.getInitialCards()])\n        .then(([user, items]) => {\n          setCurrentUser(user.data);\n          setCards(items);\n          navigate('/');\n        })\n        .catch((err) => {\n          console.log(err);\n          return [];\n        });\n    }\n  }, [loggedIn]); \n\n  useEffect(() => {\n    handleTokenCheck(location.pathname);\n    console.log('lp'+location.pathname);\n  }, []);\n\n  const [currentUser, setCurrentUser] = React.useState({});\n  const [cards, setCards] = React.useState([]);\n\n  function handleCardLike(card){\n    const isLiked = card.likes.some((i) => i === currentUser._id);\n    if (isLiked) {\n      api\n        .deleteLike(card._id)\n        .then((newCard) => {\n          setCards((state) => state.map((c) => (c._id === card._id ? newCard.data : c)));\n        })\n        .catch((err) => {\n          console.log(err);\n          return [];\n        });\n    } else {\n      api\n        .addLike(card._id)\n        .then((newCard) => {\n          setCards((state) => state.map((c) => (c._id === card._id ? newCard : c)));\n          console.log(card);\n        })\n        .catch((err) => {\n          console.log(err);\n          return [];\n        });\n    }\n  } \n////////////////\n  function handleEditUser(data) {\n    api\n      .editProfile(data)\n      .then((data) => {\n        setCurrentUser(data.data);\n        console.log(data);\n        closeAllPopups();\n      })\n      .catch((err) => console.log(err));\n  }\n\n  function handleUpdateAvatar(data) {\n    api\n      .addAvatar(data)\n      .then((data) => {\n        console.log(data);\n        setCurrentUser(data.data);\n        closeAllPopups();\n      })\n      .catch((err) => console.log(err));\n  }\n  function handleAddPlace(data) {\n    api\n      .addPlace(data)\n      .then((newCard) => {\n       // console.log(data);\n       // console.log(newCard);\n       // console.log(newCard.data);\n        setCards([newCard.data, ...cards]);\n        closeAllPopups();\n      })\n      .catch((err) => console.log(err));\n  }\n  const [isDeletePopupOpenen, setIsDeletePopupOpenen] =React.useState(false);\n  function handleCardDeleteClick(card) {\n    setIsDeletePopupOpenen(true);\n    setSelectedCard(card);\n  }\n  function handleDeletePlace(card) {\n    api\n      .deletePost(card._id)\n      .then(() => {\n        setCards((state) => state.filter((c) => c._id !== card._id));\n        closeAllPopups();\n      })\n      .catch((err) => console.log(err));\n  }\n  const handleLogin = (email, password) => {\n    auth\n    .authorize(email, password)\n      .then((res) => {\n        if (res.token) {\n          localStorage.setItem('jwt', res.token);\n          setUserEmail(email);\n        }\n        setLoggedIn(true);\n      })\n      .catch((err) => {\n        console.log(err);\n        setIsSucceed(false);\n        handleInfoTooltipPopupOpen();\n      });\n  };\n  const handleTokenCheck = () => {\n    const jwt = localStorage.getItem(\"jwt\");\n\n    // проверяем токен пользователя\n    if(jwt){\n      auth.checkToken(jwt).then((res) => {\n        if (res) {\n          setUserEmail(res.data.email);\n          setLoggedIn(true);\n        }\n      })\n      .catch((err) => console.log(err));\n    }\n  };\n\n  const handleLogout= (evt) => {\n    evt.preventDefault();\n    localStorage.removeItem('jwt');\n    setLoggedIn(false);\n    setUserEmail('');\n    navigate('/sign-in')\n  }\n\n  const handleRegister = (password, email) => {\n    auth.register(email, password)\n      .then((res) => {\n        if (res) {\n          setIsSucceed(true);\n          handleInfoTooltipPopupOpen();\n          navigate(\"/sign-in\");\n        }\n      })\n      .catch((err) => {\n        console.log(`Ошибка регистрации ${err}`);\n        setIsSucceed(false);\n        handleInfoTooltipPopupOpen();\n      });\n  }; \n\n  return (\n    <CurrentUserContext.Provider value={currentUser}>\n      <div className=\"page\">\n          <Routes>\n            <>\n              <Route\n                path=\"/\"\n                element={\n                  <>\n                    <RequireAuth loggedIn={loggedIn}>\n                      <div>\n                        <Header \n                        nav={'/sign-in'}\n                        navStatus={'Выйти'} \n                        emailUser={userEmail} \n                        onLogout={handleLogout} \n                        />\n                        <Main \n                          onEditProfile={handleEditProfileClick}\n                          onAddPlace={handleAddCardClick}\n                          onEditAvatar={handleAvatarProfileClick}\n                          onCardClick={handleCardClick}\n                          onCardLike={handleCardLike}\n                          onCardDeleteClick={handleCardDeleteClick}\n                          cards={cards}\n                        />  \n                        <Footer />\n                      </div>\n                    </RequireAuth>\n                  </>\n                }\n              />  \n              <Route path=\"/sign-up\" element={<Register onRegister={handleRegister}/> } />\n              <Route path=\"/sign-in\" element={<Login onLogin={handleLogin}/>} />\n              <Route\n                  path='*'\n                  element={loggedIn ? <Navigate to='/' /> : <Navigate to='/sign-in' />}\n              />\n            </> \n          </Routes>\n          <InfoTooltip\n            isOpen={isInfoTooltipOpen}\n            onClose={closeAllPopups}\n            isSucceed={isSucceed}\n          />\n          <EditProfilePopup\n            isOpen={isEditProfilePopupOpen}\n            onClose={closeAllPopups}\n            onEditUser={handleEditUser}\n          />\n          <AddPopup\n            isOpen={isAddCardPopupOpen}\n            onClose={closeAllPopups}\n            onAddPost={handleAddPlace}\n          />\n          <EditAvatarPopup\n            isOpen={isAvatarProfilePopupOpen}\n            onClose={closeAllPopups}\n            onUpdateAvatar={handleUpdateAvatar}\n          />\n          <ImagePopup \n            isOpen={isImagePopupOpenen}\n            card={selectedCard}\n            onClose={closeAllPopups}\n          />\n          <DeletePopup\n            isOpen={isDeletePopupOpenen}\n            onClose={closeAllPopups}\n            card={selectedCard}\n            onDeletePlace={handleDeletePlace}\n          />\n      </div>\n    </CurrentUserContext.Provider>\n  );\n}\n\nexport default App;"]},"metadata":{},"sourceType":"module"}